<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

    <changeSet id="create-tables" author="dev">
        <createTable tableName="rental_property">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="city" type="VARCHAR(255)"/>
            <column name="houseNumber" type="VARCHAR(255)"/>
            <column name="street" type="VARCHAR(255)"/>
            <column name="zipCode" type="VARCHAR(255)"/>
        </createTable>

        <createTable tableName="house">
            <column name="id" type="BIGINT">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="landSize" type="FLOAT"/>
            <column name="livingArea" type="FLOAT"/>
            <column name="roomCount" type="INT"/>
            <column name="isEntireHouseRented" type="BOOLEAN"/>
        </createTable>

        <createTable tableName="apartment">
            <column name="id" type="BIGINT">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="livingArea" type="FLOAT"/>
            <column name="roomCount" type="INT"/>
            <column name="house_id" type="BIGINT"/>
        </createTable>

        <createTable tableName="rental_contract">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="coldRent" type="FLOAT"/>
            <column name="warmRent" type="FLOAT"/>
            <column name="startDate" type="DATE"/>
            <column name="endDate" type="DATE"/>
            <column name="rental_property_id" type="BIGINT"/>
        </createTable>

        <createTable tableName="person">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="firstName" type="VARCHAR(255)"/>
            <column name="lastName" type="VARCHAR(255)"/>
            <column name="birthDate" type="DATE"/>
            <column name="email" type="VARCHAR(255)"/>
            <column name="rental_contract_id" type="BIGINT"/>
        </createTable>

        <createTable tableName="utility_statement">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="year" type="INT"/>
            <column name="totalCost" type="FLOAT"/>
            <column name="rental_property_id" type="BIGINT"/>
        </createTable>

        <createTable tableName="utility_cost">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="billingType" type="SMALLINT"/>
            <column name="price" type="FLOAT"/>
            <column name="date" type="DATE"/>
            <column name="isBillable" type="BOOLEAN"/>
            <column name="utility_statement_id" type="BIGINT"/>
        </createTable>

        <createTable tableName="attachment">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="data" type="TINYBLOB"/>
            <column name="fileName" type="VARCHAR(255)"/>
            <column name="fileType" type="VARCHAR(255)"/>
            <column name="utility_cost_id" type="BIGINT"/>
        </createTable>

        <createTable tableName="finalized_attachment">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="data" type="TINYBLOB"/>
            <column name="fileName" type="VARCHAR(255)"/>
            <column name="fileType" type="VARCHAR(255)"/>
            <column name="finalized_utility_cost_id" type="BIGINT"/>
        </createTable>

        <createTable tableName="finalized_utility_cost">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="billingType" type="SMALLINT"/>
            <column name="individualShare" type="FLOAT"/>
            <column name="totalCost" type="FLOAT"/>
            <column name="finalized_statement_id" type="BIGINT"/>
        </createTable>

        <createTable tableName="finalized_utility_statement">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="breakdown" type="VARCHAR(255)"/>
            <column name="individualCost" type="FLOAT"/>
            <column name="rental_property_id" type="BIGINT"/>
            <column name="utility_statement_id" type="BIGINT"/>
        </createTable>
    </changeSet>

    <!-- Foreign Keys -->
    <changeSet id="add-foreign-keys" author="dev">
        <addForeignKeyConstraint baseTableName="apartment"
                                 baseColumnNames="house_id"
                                 referencedTableName="house"
                                 referencedColumnNames="id"
                                 constraintName="FK_apartment_house"/>

        <addForeignKeyConstraint baseTableName="apartment"
                                 baseColumnNames="id"
                                 referencedTableName="rental_property"
                                 referencedColumnNames="id"
                                 constraintName="FK_apartment_rental_property"/>

        <addForeignKeyConstraint baseTableName="rental_contract"
                                 baseColumnNames="rental_property_id"
                                 referencedTableName="rental_property"
                                 referencedColumnNames="id"
                                 constraintName="FK_contract_property"/>

        <addForeignKeyConstraint baseTableName="person"
                                 baseColumnNames="rental_contract_id"
                                 referencedTableName="rental_contract"
                                 referencedColumnNames="id"
                                 constraintName="FK_person_contract"/>

        <addForeignKeyConstraint baseTableName="utility_cost"
                                 baseColumnNames="utility_statement_id"
                                 referencedTableName="utility_statement"
                                 referencedColumnNames="id"
                                 constraintName="FK_cost_statement"/>

        <addForeignKeyConstraint baseTableName="utility_statement"
                                 baseColumnNames="rental_property_id"
                                 referencedTableName="rental_property"
                                 referencedColumnNames="id"
                                 constraintName="FK_statement_property"/>

        <addForeignKeyConstraint baseTableName="attachment"
                                 baseColumnNames="utility_cost_id"
                                 referencedTableName="utility_cost"
                                 referencedColumnNames="id"
                                 constraintName="FK_attachment_cost"/>

        <addForeignKeyConstraint baseTableName="finalized_attachment"
                                 baseColumnNames="finalized_utility_cost_id"
                                 referencedTableName="finalized_utility_cost"
                                 referencedColumnNames="id"
                                 constraintName="FK_finalized_attachment_cost"/>

        <addForeignKeyConstraint baseTableName="finalized_utility_cost"
                                 baseColumnNames="finalized_statement_id"
                                 referencedTableName="finalized_utility_statement"
                                 referencedColumnNames="id"
                                 constraintName="FK_finalized_cost_statement"/>

        <addForeignKeyConstraint baseTableName="finalized_utility_statement"
                                 baseColumnNames="rental_property_id"
                                 referencedTableName="rental_property"
                                 referencedColumnNames="id"
                                 constraintName="FK_finalized_statement_property"/>

        <addForeignKeyConstraint baseTableName="finalized_utility_statement"
                                 baseColumnNames="utility_statement_id"
                                 referencedTableName="utility_statement"
                                 referencedColumnNames="id"
                                 constraintName="FK_finalized_statement_original"/>
    </changeSet>

</databaseChangeLog>